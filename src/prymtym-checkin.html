<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/neon-animation/neon-animatable-behavior.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html">

<dom-module id="prymtym-checkin">

  <template>

    <style>
      :host {
        display: block;
        position: fixed;
        z-index: 10;        
      }
      .checkin {
        width: 100%;
        height: 100vh;
        background: white;
        position: absolute;
        top: 0;
        //display: none;
      }
      .checkin-header {
        height: 64px;
        width: 100%;
        background-color: #BF360C;
      }
      .arrow-back {
        color: white;
        margin: 10px 8px;
      }
      .question-container {
        background: #BF360C;
        color: white;
        min-height: 50px;
        padding: 16px;
        display: flex;
        padding-left: 24px;

      }
      .question-container h1 {
        margin: 0;
        font-weight: 400;
      }
      .answers-container {
        display: flex;
        justify-content: center;
        //align-items: center;
        padding: 16px;
        padding-top: 64px;
        height: 100px;
      }
      .answer-icon {
        width: 80px;
        width: 64px;
        padding-left: 8px;
        padding-right: 8px;
        -webkit-filter: grayscale(100%); /* Chrome, Safari, Opera */
        filter: grayscale(100%);
      }
      .answer-text {
        display: none;
        text-align: center;
        font-size: 12px;
        font-weight: 500;
        color: #666;
      }
      .submit-answer {
        position: fixed;
        bottom: 16px;
        right: 16px;
        background: orange;
        display: none;
      }
    </style>
    
      <div id="checkin" class="checkin">
        
        <div class="checkin-header">
          <a name="home" href="/home">
            <paper-icon-button on-click="goBack" class="arrow-back" icon="close"></paper-icon-button>
          </a>
        </div>

        <div class="question-container">
          <h1>How are you feeling ?</h1>
        </div>
        
        
        
        <div>
          <iron-selector selected="{{answer}}" id="answers" class="answers-container">
            <div on-click="selectedAnswer">
              <img class="answer-icon" src="../images/1.png"></img>
              <div class="answer-text">Awesome</div>
            </div>
            <div on-click="selectedAnswer">
              <img class="answer-icon" src="../images/2.png"></img>
              <div class="answer-text">Good</div>
            </div>
            <div on-click="selectedAnswer">
              <img class="answer-icon" src="../images/3.png"></img>
              <div class="answer-text">Meh</div>
            </div>
            <div on-click="selectedAnswer">
              <img class="answer-icon" src="../images/4.png"></img>
              <div class="answer-text">Awful</div>
            </div>
          </iron-selector>
        </div>
        
       
      
        <paper-fab id="submitAnswer" on-click="submitAnswer" class="submit-answer" icon="icons:check"></paper-fab>
        
      </div>    
    
  </template>

  <script>
    Polymer({
      is: 'prymtym-checkin',
      properties: {
        visible: {
          type: Boolean,
          observer: '_visibleChanged'
        },
        data: {
          type: Number,
          observer: 'dataChanged'
        },
        user: {
          type: Object,
          notify: true,
          observer: '_userChanged'
        },  
        firstName: {
          type: String
        },        
        animationConfig: {
          value: function() {
            return {
              'entry': {
                name: 'fade-in-animation',
                node: this
              },
              'exit': {
                name: 'fade-out-animation',
                node: this
              }
            }
          }
        }
      },
      behaviors: [
        Polymer.NeonAnimatableBehavior
      ],      
      _visibleChanged: function(visible) {
        if (visible) {
          this.fire('change-section', { title: 'Checkin' });
        }
      },
      dataChanged: function (newData, oldData) {
        //console.log(this.data);
      },
      goBack: function () {
        this.selectedWrapper = 0;
      },
      selectedAnswer: function (e) {
        var images = this.$.answers.querySelectorAll('.answer-icon');
        [].forEach.call(images, function(image) {
          image.style.webkitFilter = "grayscale(100%)";
        });
        e.target.style.webkitFilter = "none";
        
        var textDivs = this.$.answers.querySelectorAll('.answer-text');
        [].forEach.call(textDivs, function(div) {
          div.style.display = "none";
        });        
        e.target.nextElementSibling.style.display = "block";
        this.$.submitAnswer.style.display = "block";
      },
      submitAnswer: function () {
        var d = new Date();
        var year = d.getFullYear();
        var month = d.getMonth() + 1;
        var date = d.getDate();
        var hour = d.getHours();
        var path = "users/"+this.user.uid+"/energyLevels/" + year + "/" + month
          + "/" + date + "/" + hour + "/";
        var data = this.answer;
        this.$.checkinDoc.setStoredValue(path, data);
        this.selectedWrapper = 0;
        this.checkedIn = Math.random();
      },
      _userChanged: function () {
        if (this.user) {
          this.firstName = this.user.displayName.split(" ")[0];
          console.log(this.firstName);
        }
      }
    });
  </script>

</dom-module>